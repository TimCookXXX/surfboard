const openItem = item => {
  const container = item.closest('.team__item');
  const contentBlock = container.find('.team__content');
  const textBlock = contentBlock.find('.team__content-block');
  const reqHeight = textBlock.height();

  container.addClass('active');
  contentBlock.height(reqHeight);
}

const closeItem = container => {
  const items = container.find('.team__content');
  const itemContainer = container.find('.team__item');


  itemContainer.removeClass('active');
  items.height(0);

}

$('.team__title').click(e => {
  const $this = $(e.currentTarget);
  const container = $this.closest('.team');
  const elemContainer = $this.closest('.team__item');

  if (elemContainer.hasClass('active')) {
  closeItem(container);
  } else {
  closeItem(container);
  openItem($this);
  }
});;let myMap;

const init = () => {
    myMap = new ymaps.Map('map', {
    center: [55.752004, 37.576133],
    zoom: 16,
    controls: ["zoomControl"]
  });

  const coords = [
    [55.752004, 37.576133]
];

const myCollection = new ymaps.GeoObjectCollection({}, {
  draggable: false,
  iconLayout: 'default#image',
  iconImageHref: './images/img/marker.svg' ,
  iconImageSize: [58, 73],
  iconImageOffset: [-3, -42]
});

coords.forEach(coord => {
  myCollection.add(new ymaps.Placemark(coord));
});

myMap.geoObjects.add(myCollection);

myMap.behaviors.disable('scrollZoom');

};

ymaps.ready(init);;const mesureWidth = item => {
  let reqItemWidth = 0;
  const screenWidth = $(window).width();
  const container = item.closest('.products-menu');
  const titleBlocks = container.find('.products-menu__title');
  const titleWidth = titleBlocks.width() * titleBlocks.length;

  const textContainer = item.find('.products-menu__container');
  const paddingLeft = parseInt(textContainer.css('padding-left'));
  const paddingRight = parseInt(textContainer.css('padding-right'));

  const isMobile = window.matchMedia('(max-width: 768px)').matches;

  if(isMobile) {
    reqItemWidth = screenWidth - titleWidth;
  } else {
    reqItemWidth = 524;
  }

  return {
    container: reqItemWidth,
    textContainer: reqItemWidth - paddingRight - paddingLeft
  }

};

const closeEveryItemInContainer = container => {
  const items = container.find('.products-menu__item');
  const content = container.find('.products-menu__content');
  items.removeClass('active');

  content.width(0);
}

const openItemMenu = item => {
  const hiddenContent = item.find('.products-menu__content');
  const reqWidth = mesureWidth(item);
  const textBlock = item.find('.products-menu__container');


  item.addClass('active');
  hiddenContent.width(reqWidth.container);
  textBlock.width(reqWidth.textContainer);
}

$('.products-menu__title').on('click', e => {

  const $this = $(e.currentTarget);
  const item = $this.closest('.products-menu__item');
  const itemOpened = item.hasClass('active');
  const container = $this.closest('.products-menu');

  if(itemOpened) {
    closeEveryItemInContainer(container);
  } else {
    closeEveryItemInContainer(container);
    openItemMenu(item);
  }
});;const openButton = document.querySelector('.hamburger');
const closeButton = document.querySelector('.fullscreen-menu__close');
const menu = document.querySelector('.fullscreen-menu');


$('.menu__item').click(e => {
  menu.style.display = 'none'
})


openButton.addEventListener('click', function(e) {
  menu.style.display = 'block'
});

closeButton.addEventListener('click', function(e) {
  menu.style.display = 'none'
});;const validateFields = (form, fieldsArray) => {

  fieldsArray.forEach((field) => {
    field.removeClass('input-error');
    if (field.val().trim() == "") {
      field.addClass('input-error')
    }
  });

  const errorFields = form.find('.input-error');

  return errorFields.length == 0;

}

$('.form').submit(e => { 
  e.preventDefault();

  const form = $(e.currentTarget);
  const name = form.find("[name = 'name']");
  const phone = form.find("[name = 'phone']");
  const street = form.find("[name = 'street']");
  const house = form.find("[name = 'house']");
  const comment = form.find("[name = 'comment']");
  const to = form.find("[name = 'to']");

  const modal = $('#modal');
  const content = modal.find('.modal__content');

  modal.removeClass('error-modal');

  const isValid = validateFields(form, [name, phone, street, house, comment, to]);


  if (isValid) {

    const request = $.ajax({
      url: "https://webdev-api.loftschool.com/sendmail",
      method: "post",
      data: {
        name: name.val(),
        phone: phone.val(),
        comment: comment.val(),
        to: to.val()
      },
    });

    request.done(data => {
      content.text(data.message);
    });

    request.fail(data => {
      const message = data.responseJSON.message;
        content.text(message);
        modal.addClass('error-modal');
    });

    request.always(() => {
      $.fancybox.open({
        src: "#modal",
        type: "inline"
      });

    })

  } 
});

$('.app-close-modal').click(e => {
  e.preventDefault();

  $.fancybox.close();
});const sections = $('section');
const display = $('.maincontent');
const sideMenu = $('.fixed-menu');
const menuItems = sideMenu.find('.fixed-menu__item');

const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile(); 

let inScroll = false;

sections.first().addClass('active');

const countSectionPosition = (sectionEq) => {
  const position = sectionEq * -100;

  if (isNaN(position)) {
    console.error('Передано не верное значение в countSectionPosition');
    return 0;
  }

  return position;
}

const changeMenuThemeForSection = sectionEq => {

  const currentSection = sections.eq(sectionEq);
  const menuTheme = currentSection.attr('data-sidemenu-theme');
  const activeClass = 'fixed-menu--shadowed';

  if (menuTheme == 'black') {
    sideMenu.addClass(activeClass)
  } else {
    sideMenu.removeClass(activeClass)
  }

}

const resetActiveClassForItem = (items, itemEq, activeClass) => {
  items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
}

const performTransition = sectionEq => {

  if (inScroll) return;

  const transitionOver = 1000;
  const mouseInertiaOver = 300;

  inScroll = true;
  const position = countSectionPosition(sectionEq);

  changeMenuThemeForSection(sectionEq);

  display.css({
    transform: `translateY(${position}%)`
  });

  resetActiveClassForItem(sections, sectionEq, 'active');

  setTimeout(() => {
    inScroll = false;
    resetActiveClassForItem(menuItems, sectionEq, 'fixed-menu__item--active')
  }, transitionOver + mouseInertiaOver);
};

const viewportScroller = () => {

  const activeSection = sections.filter('.active');
  const nextSection = activeSection.next();
  const prevSection = activeSection.prev();

  return {
    next() {
      if (nextSection.length) {
        performTransition(nextSection.index())
      }
    },
    prev() {
      if (prevSection.length) {
        performTransition(prevSection.index())
      }
    },
  };
};

$(window).on('wheel', e => {
  const deltaY = e.originalEvent.deltaY;
  const scroller = viewportScroller();

  if (deltaY > 0) {
    scroller.next();
  }

  if (deltaY < 0) {
    scroller.prev();
  }
});

$(window).on('keydown', e => {
  const tagName = e.target.tagName.toLowerCase();
  const userTypingInInputs = tagName == 'input' || tagName == 'textarea';
  const scroller = viewportScroller();

  if (userTypingInInputs) return;

  switch (e.keyCode) {
    case 87:
      scroller.prev();
      break;

    case 83:
      scroller.next();
      break;
  }

});

$('.wrapper').on('touchmove', e => e.preventDefault());

$('[data-scroll-to]').click(e => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr('data-scroll-to');
  const reqSection = $(`[data-section-id=${target}]`);

  performTransition(reqSection.index());
});

if (isMobile) {
  $("body").swipe({
    swipe: function (event, direction) {
      const scroller = viewportScroller();
      let scrollDirection = '';
  
      if (direction == 'up') scrollDirection = 'next';
      if (direction == 'down') scrollDirection = 'prev';
  
      scroller[scrollDirection]();
    },
  });
}
;const playBtn = document.querySelector('.video__player-img');
const video = document.getElementById('player');
const playerPlayBtn = document.querySelector('.duration__img');
const durationControl = document.getElementById('durationLevel');
const soundControl = document.getElementById('dynamicLevel');
const soundBtn = document.querySelector('.sound');
const dynamicBtn = document.getElementById('dynamic');
let intervalId;
let soundLevel;

video.addEventListener('loadeddata', function () {
  video.addEventListener('click', playStop);

  const playButtons = document.querySelectorAll('.play');

  for (let i = 0; i < playButtons.length; i++) {
    playButtons[i].addEventListener('click', playStop);
  }

  durationControl.min = 0;
  durationControl.value = 0;
  durationControl.max = video.duration;
  durationControl.addEventListener('input', setVideoDuration);

  soundControl.min = 0;
  soundControl.max = 10;
  soundControl.value = soundControl.max;
  soundControl.addEventListener('input', changeSoundVolume);

  dynamicBtn.addEventListener('click', soundOf);

  video.addEventListener('ended', () => {
    playBtn.classList.toggle('video__player-img--active');
    playerPlayBtn.classList.remove('active');
    video.currentTime = 0;

  })
});

function playStop() {
  playBtn.classList.toggle('video__player-img--active');
  playerPlayBtn.classList.toggle('active');
  if (video.paused) {
    video.play()
    intervalId = setInterval(updateDuration, 1000 / 60);
  } else {
    video.pause()
    clearInterval(intervalId)
  }
}

function setVideoDuration() {
  video.currentTime = durationControl.value;
  updateDuration();
}

function updateDuration() {
  durationControl.value = video.currentTime;
  let step = video.duration / 100;
  let percent = video.currentTime / step;
  durationControl.style.background = `linear-gradient(90deg, #FEDB3F 0%, #FEDB3F ${percent}%, #626262 ${percent}%)`;
}

function changeSoundVolume() {
  video.volume = soundControl.value / 10;
  if (video.volume === 0) {
    soundBtn.classList.add('active');
  } else {
    soundBtn.classList.remove('active');
  }
}

function soundOf() {
  if (video.volume === 0) {
    video.volume = soundLevel;
    soundControl.value = soundLevel * 10;
    soundBtn.classList.remove('active');
  } else {
    soundLevel = video.volume;
    video.volume = 0;
    soundControl.value = 0;
    soundBtn.classList.add('active');
  }
};const slider = $('.products').bxSlider({
  pager: false,
  controls: false
});

$('.product-slider__arrow--direction--prev').click(e => {
  slider.goToPrevSlide();
});

$('.product-slider__arrow--direction--next').click(e => {
  slider.goToNextSlide();
});;const findBlockByAlias = alias => {
  return $('.reviews__item').filter((ndx, item) => {
    return $(item).attr('data-linked-with') == alias
  });
};

$('.interactive-avatar__link').click(e => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr('data-open');
  const itemToShow = findBlockByAlias(target);
  const curItem = $this.closest('.reviews__switcher-item');

  itemToShow.addClass('active').siblings().removeClass('active');
  curItem.addClass('active').siblings().removeClass('active');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY28uanMiLCJtYXAuanMiLCJtZW51LWFjY28uanMiLCJtZW51LmpzIiwibW9kYWwuanMiLCJvcHMuanMiLCJwbGF5ZXIuanMiLCJzbGlkZXIuanMiLCJ0YWJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdDeEVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0M5SUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVDbkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQ1hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBvcGVuSXRlbSA9IGl0ZW0gPT4ge1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdCgnLnRlYW1fX2l0ZW0nKTtcclxuICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZCgnLnRlYW1fX2NvbnRlbnQnKTtcclxuICBjb25zdCB0ZXh0QmxvY2sgPSBjb250ZW50QmxvY2suZmluZCgnLnRlYW1fX2NvbnRlbnQtYmxvY2snKTtcclxuICBjb25zdCByZXFIZWlnaHQgPSB0ZXh0QmxvY2suaGVpZ2h0KCk7XHJcblxyXG4gIGNvbnRhaW5lci5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgY29udGVudEJsb2NrLmhlaWdodChyZXFIZWlnaHQpO1xyXG59XHJcblxyXG5jb25zdCBjbG9zZUl0ZW0gPSBjb250YWluZXIgPT4ge1xyXG4gIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoJy50ZWFtX19jb250ZW50Jyk7XHJcbiAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKCcudGVhbV9faXRlbScpO1xyXG5cclxuXHJcbiAgaXRlbUNvbnRhaW5lci5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcbiAgaXRlbXMuaGVpZ2h0KDApO1xyXG5cclxufVxyXG5cclxuJCgnLnRlYW1fX3RpdGxlJykuY2xpY2soZSA9PiB7XHJcbiAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnRlYW0nKTtcclxuICBjb25zdCBlbGVtQ29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnRlYW1fX2l0ZW0nKTtcclxuXHJcbiAgaWYgKGVsZW1Db250YWluZXIuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XHJcbiAgY2xvc2VJdGVtKGNvbnRhaW5lcik7XHJcbiAgfSBlbHNlIHtcclxuICBjbG9zZUl0ZW0oY29udGFpbmVyKTtcclxuICBvcGVuSXRlbSgkdGhpcyk7XHJcbiAgfVxyXG59KTsiLCJsZXQgbXlNYXA7XHJcblxyXG5jb25zdCBpbml0ID0gKCkgPT4ge1xyXG4gICAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKCdtYXAnLCB7XHJcbiAgICBjZW50ZXI6IFs1NS43NTIwMDQsIDM3LjU3NjEzM10sXHJcbiAgICB6b29tOiAxNixcclxuICAgIGNvbnRyb2xzOiBbXCJ6b29tQ29udHJvbFwiXVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBjb29yZHMgPSBbXHJcbiAgICBbNTUuNzUyMDA0LCAzNy41NzYxMzNdXHJcbl07XHJcblxyXG5jb25zdCBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSwge1xyXG4gIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gIGljb25JbWFnZUhyZWY6ICcuLi9pbWFnZXMvaW1nL21hcmtlci5zdmcnICxcclxuICBpY29uSW1hZ2VTaXplOiBbNTgsIDczXSxcclxuICBpY29uSW1hZ2VPZmZzZXQ6IFstMywgLTQyXVxyXG59KTtcclxuXHJcbmNvb3Jkcy5mb3JFYWNoKGNvb3JkID0+IHtcclxuICBteUNvbGxlY3Rpb24uYWRkKG5ldyB5bWFwcy5QbGFjZW1hcmsoY29vcmQpKTtcclxufSk7XHJcblxyXG5teU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG5cclxubXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoJ3Njcm9sbFpvb20nKTtcclxuXHJcbn07XHJcblxyXG55bWFwcy5yZWFkeShpbml0KTsiLCJjb25zdCBtZXN1cmVXaWR0aCA9IGl0ZW0gPT4ge1xyXG4gIGxldCByZXFJdGVtV2lkdGggPSAwO1xyXG4gIGNvbnN0IHNjcmVlbldpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XHJcbiAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KCcucHJvZHVjdHMtbWVudScpO1xyXG4gIGNvbnN0IHRpdGxlQmxvY2tzID0gY29udGFpbmVyLmZpbmQoJy5wcm9kdWN0cy1tZW51X190aXRsZScpO1xyXG4gIGNvbnN0IHRpdGxlV2lkdGggPSB0aXRsZUJsb2Nrcy53aWR0aCgpICogdGl0bGVCbG9ja3MubGVuZ3RoO1xyXG5cclxuICBjb25zdCB0ZXh0Q29udGFpbmVyID0gaXRlbS5maW5kKCcucHJvZHVjdHMtbWVudV9fY29udGFpbmVyJyk7XHJcbiAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0Q29udGFpbmVyLmNzcygncGFkZGluZy1sZWZ0JykpO1xyXG4gIGNvbnN0IHBhZGRpbmdSaWdodCA9IHBhcnNlSW50KHRleHRDb250YWluZXIuY3NzKCdwYWRkaW5nLXJpZ2h0JykpO1xyXG5cclxuICBjb25zdCBpc01vYmlsZSA9IHdpbmRvdy5tYXRjaE1lZGlhKCcobWF4LXdpZHRoOiA3NjhweCknKS5tYXRjaGVzO1xyXG5cclxuICBpZihpc01vYmlsZSkge1xyXG4gICAgcmVxSXRlbVdpZHRoID0gc2NyZWVuV2lkdGggLSB0aXRsZVdpZHRoO1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXFJdGVtV2lkdGggPSA1MjQ7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgY29udGFpbmVyOiByZXFJdGVtV2lkdGgsXHJcbiAgICB0ZXh0Q29udGFpbmVyOiByZXFJdGVtV2lkdGggLSBwYWRkaW5nUmlnaHQgLSBwYWRkaW5nTGVmdFxyXG4gIH1cclxuXHJcbn07XHJcblxyXG5jb25zdCBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyID0gY29udGFpbmVyID0+IHtcclxuICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKCcucHJvZHVjdHMtbWVudV9faXRlbScpO1xyXG4gIGNvbnN0IGNvbnRlbnQgPSBjb250YWluZXIuZmluZCgnLnByb2R1Y3RzLW1lbnVfX2NvbnRlbnQnKTtcclxuICBpdGVtcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XHJcblxyXG4gIGNvbnRlbnQud2lkdGgoMCk7XHJcbn1cclxuXHJcbmNvbnN0IG9wZW5JdGVtTWVudSA9IGl0ZW0gPT4ge1xyXG4gIGNvbnN0IGhpZGRlbkNvbnRlbnQgPSBpdGVtLmZpbmQoJy5wcm9kdWN0cy1tZW51X19jb250ZW50Jyk7XHJcbiAgY29uc3QgcmVxV2lkdGggPSBtZXN1cmVXaWR0aChpdGVtKTtcclxuICBjb25zdCB0ZXh0QmxvY2sgPSBpdGVtLmZpbmQoJy5wcm9kdWN0cy1tZW51X19jb250YWluZXInKTtcclxuXHJcblxyXG4gIGl0ZW0uYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gIGhpZGRlbkNvbnRlbnQud2lkdGgocmVxV2lkdGguY29udGFpbmVyKTtcclxuICB0ZXh0QmxvY2sud2lkdGgocmVxV2lkdGgudGV4dENvbnRhaW5lcik7XHJcbn1cclxuXHJcbiQoJy5wcm9kdWN0cy1tZW51X190aXRsZScpLm9uKCdjbGljaycsIGUgPT4ge1xyXG5cclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBpdGVtID0gJHRoaXMuY2xvc2VzdCgnLnByb2R1Y3RzLW1lbnVfX2l0ZW0nKTtcclxuICBjb25zdCBpdGVtT3BlbmVkID0gaXRlbS5oYXNDbGFzcygnYWN0aXZlJyk7XHJcbiAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnByb2R1Y3RzLW1lbnUnKTtcclxuXHJcbiAgaWYoaXRlbU9wZW5lZCkge1xyXG4gICAgY2xvc2VFdmVyeUl0ZW1JbkNvbnRhaW5lcihjb250YWluZXIpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgICBvcGVuSXRlbU1lbnUoaXRlbSk7XHJcbiAgfVxyXG59KTsiLCJjb25zdCBvcGVuQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhhbWJ1cmdlcicpO1xyXG5jb25zdCBjbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mdWxsc2NyZWVuLW1lbnVfX2Nsb3NlJyk7XHJcbmNvbnN0IG1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuZnVsbHNjcmVlbi1tZW51Jyk7XHJcblxyXG5cclxuJCgnLm1lbnVfX2l0ZW0nKS5jbGljayhlID0+IHtcclxuICBtZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcclxufSlcclxuXHJcblxyXG5vcGVuQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gIG1lbnUuc3R5bGUuZGlzcGxheSA9ICdibG9jaydcclxufSk7XHJcblxyXG5jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICBtZW51LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcclxufSk7IiwiY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcclxuXHJcbiAgZmllbGRzQXJyYXkuZm9yRWFjaCgoZmllbGQpID0+IHtcclxuICAgIGZpZWxkLnJlbW92ZUNsYXNzKCdpbnB1dC1lcnJvcicpO1xyXG4gICAgaWYgKGZpZWxkLnZhbCgpLnRyaW0oKSA9PSBcIlwiKSB7XHJcbiAgICAgIGZpZWxkLmFkZENsYXNzKCdpbnB1dC1lcnJvcicpXHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIGNvbnN0IGVycm9yRmllbGRzID0gZm9ybS5maW5kKCcuaW5wdXQtZXJyb3InKTtcclxuXHJcbiAgcmV0dXJuIGVycm9yRmllbGRzLmxlbmd0aCA9PSAwO1xyXG5cclxufVxyXG5cclxuJCgnLmZvcm0nKS5zdWJtaXQoZSA9PiB7IFxyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWUgPSAnbmFtZSddXCIpO1xyXG4gIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWUgPSAncGhvbmUnXVwiKTtcclxuICBjb25zdCBzdHJlZXQgPSBmb3JtLmZpbmQoXCJbbmFtZSA9ICdzdHJlZXQnXVwiKTtcclxuICBjb25zdCBob3VzZSA9IGZvcm0uZmluZChcIltuYW1lID0gJ2hvdXNlJ11cIik7XHJcbiAgY29uc3QgY29tbWVudCA9IGZvcm0uZmluZChcIltuYW1lID0gJ2NvbW1lbnQnXVwiKTtcclxuICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lID0gJ3RvJ11cIik7XHJcblxyXG4gIGNvbnN0IG1vZGFsID0gJCgnI21vZGFsJyk7XHJcbiAgY29uc3QgY29udGVudCA9IG1vZGFsLmZpbmQoJy5tb2RhbF9fY29udGVudCcpO1xyXG5cclxuICBtb2RhbC5yZW1vdmVDbGFzcygnZXJyb3ItbW9kYWwnKTtcclxuXHJcbiAgY29uc3QgaXNWYWxpZCA9IHZhbGlkYXRlRmllbGRzKGZvcm0sIFtuYW1lLCBwaG9uZSwgc3RyZWV0LCBob3VzZSwgY29tbWVudCwgdG9dKTtcclxuXHJcblxyXG4gIGlmIChpc1ZhbGlkKSB7XHJcblxyXG4gICAgY29uc3QgcmVxdWVzdCA9ICQuYWpheCh7XHJcbiAgICAgIHVybDogXCJodHRwczovL3dlYmRldi1hcGkubG9mdHNjaG9vbC5jb20vc2VuZG1haWxcIixcclxuICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgICAgZGF0YToge1xyXG4gICAgICAgIG5hbWU6IG5hbWUudmFsKCksXHJcbiAgICAgICAgcGhvbmU6IHBob25lLnZhbCgpLFxyXG4gICAgICAgIGNvbW1lbnQ6IGNvbW1lbnQudmFsKCksXHJcbiAgICAgICAgdG86IHRvLnZhbCgpXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICByZXF1ZXN0LmRvbmUoZGF0YSA9PiB7XHJcbiAgICAgIGNvbnRlbnQudGV4dChkYXRhLm1lc3NhZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmVxdWVzdC5mYWlsKGRhdGEgPT4ge1xyXG4gICAgICBjb25zdCBtZXNzYWdlID0gZGF0YS5yZXNwb25zZUpTT04ubWVzc2FnZTtcclxuICAgICAgICBjb250ZW50LnRleHQobWVzc2FnZSk7XHJcbiAgICAgICAgbW9kYWwuYWRkQ2xhc3MoJ2Vycm9yLW1vZGFsJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXF1ZXN0LmFsd2F5cygoKSA9PiB7XHJcbiAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgc3JjOiBcIiNtb2RhbFwiLFxyXG4gICAgICAgIHR5cGU6IFwiaW5saW5lXCJcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSlcclxuXHJcbiAgfSBcclxufSk7XHJcblxyXG4kKCcuYXBwLWNsb3NlLW1vZGFsJykuY2xpY2soZSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAkLmZhbmN5Ym94LmNsb3NlKCk7XHJcbn0pIiwiY29uc3Qgc2VjdGlvbnMgPSAkKCdzZWN0aW9uJyk7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKCcubWFpbmNvbnRlbnQnKTtcclxuY29uc3Qgc2lkZU1lbnUgPSAkKCcuZml4ZWQtbWVudScpO1xyXG5jb25zdCBtZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKCcuZml4ZWQtbWVudV9faXRlbScpO1xyXG5cclxuY29uc3QgbW9iaWxlRGV0ZWN0ID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbmNvbnN0IGlzTW9iaWxlID0gbW9iaWxlRGV0ZWN0Lm1vYmlsZSgpOyBcclxuXHJcbmxldCBpblNjcm9sbCA9IGZhbHNlO1xyXG5cclxuc2VjdGlvbnMuZmlyc3QoKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcblxyXG5jb25zdCBjb3VudFNlY3Rpb25Qb3NpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICBjb25zdCBwb3NpdGlvbiA9IHNlY3Rpb25FcSAqIC0xMDA7XHJcblxyXG4gIGlmIChpc05hTihwb3NpdGlvbikpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ9Cf0LXRgNC10LTQsNC90L4g0L3QtSDQstC10YDQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSDQsiBjb3VudFNlY3Rpb25Qb3NpdGlvbicpO1xyXG4gICAgcmV0dXJuIDA7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gcG9zaXRpb247XHJcbn1cclxuXHJcbmNvbnN0IGNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24gPSBzZWN0aW9uRXEgPT4ge1xyXG5cclxuICBjb25zdCBjdXJyZW50U2VjdGlvbiA9IHNlY3Rpb25zLmVxKHNlY3Rpb25FcSk7XHJcbiAgY29uc3QgbWVudVRoZW1lID0gY3VycmVudFNlY3Rpb24uYXR0cignZGF0YS1zaWRlbWVudS10aGVtZScpO1xyXG4gIGNvbnN0IGFjdGl2ZUNsYXNzID0gJ2ZpeGVkLW1lbnUtLXNoYWRvd2VkJztcclxuXHJcbiAgaWYgKG1lbnVUaGVtZSA9PSAnYmxhY2snKSB7XHJcbiAgICBzaWRlTWVudS5hZGRDbGFzcyhhY3RpdmVDbGFzcylcclxuICB9IGVsc2Uge1xyXG4gICAgc2lkZU1lbnUucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpXHJcbiAgfVxyXG5cclxufVxyXG5cclxuY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICBpdGVtcy5lcShpdGVtRXEpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcclxufVxyXG5cclxuY29uc3QgcGVyZm9ybVRyYW5zaXRpb24gPSBzZWN0aW9uRXEgPT4ge1xyXG5cclxuICBpZiAoaW5TY3JvbGwpIHJldHVybjtcclxuXHJcbiAgY29uc3QgdHJhbnNpdGlvbk92ZXIgPSAxMDAwO1xyXG4gIGNvbnN0IG1vdXNlSW5lcnRpYU92ZXIgPSAzMDA7XHJcblxyXG4gIGluU2Nyb2xsID0gdHJ1ZTtcclxuICBjb25zdCBwb3NpdGlvbiA9IGNvdW50U2VjdGlvblBvc2l0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG4gIGNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24oc2VjdGlvbkVxKTtcclxuXHJcbiAgZGlzcGxheS5jc3Moe1xyXG4gICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYFxyXG4gIH0pO1xyXG5cclxuICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCAnYWN0aXZlJyk7XHJcblxyXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuICAgIHJlc2V0QWN0aXZlQ2xhc3NGb3JJdGVtKG1lbnVJdGVtcywgc2VjdGlvbkVxLCAnZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlJylcclxuICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG59O1xyXG5cclxuY29uc3Qgdmlld3BvcnRTY3JvbGxlciA9ICgpID0+IHtcclxuXHJcbiAgY29uc3QgYWN0aXZlU2VjdGlvbiA9IHNlY3Rpb25zLmZpbHRlcignLmFjdGl2ZScpO1xyXG4gIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbiAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIG5leHQoKSB7XHJcbiAgICAgIGlmIChuZXh0U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICBwZXJmb3JtVHJhbnNpdGlvbihuZXh0U2VjdGlvbi5pbmRleCgpKVxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgcHJldigpIHtcclxuICAgICAgaWYgKHByZXZTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgfTtcclxufTtcclxuXHJcbiQod2luZG93KS5vbignd2hlZWwnLCBlID0+IHtcclxuICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG4gIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICBpZiAoZGVsdGFZID4gMCkge1xyXG4gICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgaWYgKGRlbHRhWSA8IDApIHtcclxuICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICB9XHJcbn0pO1xyXG5cclxuJCh3aW5kb3cpLm9uKCdrZXlkb3duJywgZSA9PiB7XHJcbiAgY29uc3QgdGFnTmFtZSA9IGUudGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICBjb25zdCB1c2VyVHlwaW5nSW5JbnB1dHMgPSB0YWdOYW1lID09ICdpbnB1dCcgfHwgdGFnTmFtZSA9PSAndGV4dGFyZWEnO1xyXG4gIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICBpZiAodXNlclR5cGluZ0luSW5wdXRzKSByZXR1cm47XHJcblxyXG4gIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICBjYXNlIDg3OlxyXG4gICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgICAgIGJyZWFrO1xyXG5cclxuICAgIGNhc2UgODM6XHJcbiAgICAgIHNjcm9sbGVyLm5leHQoKTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG5cclxufSk7XHJcblxyXG4kKCcud3JhcHBlcicpLm9uKCd0b3VjaG1vdmUnLCBlID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcblxyXG4kKCdbZGF0YS1zY3JvbGwtdG9dJykuY2xpY2soZSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKCdkYXRhLXNjcm9sbC10bycpO1xyXG4gIGNvbnN0IHJlcVNlY3Rpb24gPSAkKGBbZGF0YS1zZWN0aW9uLWlkPSR7dGFyZ2V0fV1gKTtcclxuXHJcbiAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxufSk7XHJcblxyXG5pZiAoaXNNb2JpbGUpIHtcclxuICAkKFwiYm9keVwiKS5zd2lwZSh7XHJcbiAgICBzd2lwZTogZnVuY3Rpb24gKGV2ZW50LCBkaXJlY3Rpb24pIHtcclxuICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbiAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb24gPSAnJztcclxuICBcclxuICAgICAgaWYgKGRpcmVjdGlvbiA9PSAndXAnKSBzY3JvbGxEaXJlY3Rpb24gPSAnbmV4dCc7XHJcbiAgICAgIGlmIChkaXJlY3Rpb24gPT0gJ2Rvd24nKSBzY3JvbGxEaXJlY3Rpb24gPSAncHJldic7XHJcbiAgXHJcbiAgICAgIHNjcm9sbGVyW3Njcm9sbERpcmVjdGlvbl0oKTtcclxuICAgIH0sXHJcbiAgfSk7XHJcbn1cclxuIiwiY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fcGxheWVyLWltZycpO1xyXG5jb25zdCB2aWRlbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwbGF5ZXInKTtcclxuY29uc3QgcGxheWVyUGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5kdXJhdGlvbl9faW1nJyk7XHJcbmNvbnN0IGR1cmF0aW9uQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkdXJhdGlvbkxldmVsJyk7XHJcbmNvbnN0IHNvdW5kQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkeW5hbWljTGV2ZWwnKTtcclxuY29uc3Qgc291bmRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc291bmQnKTtcclxuY29uc3QgZHluYW1pY0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkeW5hbWljJyk7XHJcbmxldCBpbnRlcnZhbElkO1xyXG5sZXQgc291bmRMZXZlbDtcclxuXHJcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRlZGRhdGEnLCBmdW5jdGlvbiAoKSB7XHJcbiAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5U3RvcCk7XHJcblxyXG4gIGNvbnN0IHBsYXlCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBsYXknKTtcclxuXHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbGF5QnV0dG9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgcGxheUJ1dHRvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5U3RvcCk7XHJcbiAgfVxyXG5cclxuICBkdXJhdGlvbkNvbnRyb2wubWluID0gMDtcclxuICBkdXJhdGlvbkNvbnRyb2wudmFsdWUgPSAwO1xyXG4gIGR1cmF0aW9uQ29udHJvbC5tYXggPSB2aWRlby5kdXJhdGlvbjtcclxuICBkdXJhdGlvbkNvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBzZXRWaWRlb0R1cmF0aW9uKTtcclxuXHJcbiAgc291bmRDb250cm9sLm1pbiA9IDA7XHJcbiAgc291bmRDb250cm9sLm1heCA9IDEwO1xyXG4gIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kQ29udHJvbC5tYXg7XHJcbiAgc291bmRDb250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgY2hhbmdlU291bmRWb2x1bWUpO1xyXG5cclxuICBkeW5hbWljQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc291bmRPZik7XHJcblxyXG4gIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgKCkgPT4ge1xyXG4gICAgcGxheUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCd2aWRlb19fcGxheWVyLWltZy0tYWN0aXZlJyk7XHJcbiAgICBwbGF5ZXJQbGF5QnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgdmlkZW8uY3VycmVudFRpbWUgPSAwO1xyXG5cclxuICB9KVxyXG59KTtcclxuXHJcbmZ1bmN0aW9uIHBsYXlTdG9wKCkge1xyXG4gIHBsYXlCdG4uY2xhc3NMaXN0LnRvZ2dsZSgndmlkZW9fX3BsYXllci1pbWctLWFjdGl2ZScpO1xyXG4gIHBsYXllclBsYXlCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7XHJcbiAgaWYgKHZpZGVvLnBhdXNlZCkge1xyXG4gICAgdmlkZW8ucGxheSgpXHJcbiAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlRHVyYXRpb24sIDEwMDAgLyA2MCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHZpZGVvLnBhdXNlKClcclxuICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZClcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldFZpZGVvRHVyYXRpb24oKSB7XHJcbiAgdmlkZW8uY3VycmVudFRpbWUgPSBkdXJhdGlvbkNvbnRyb2wudmFsdWU7XHJcbiAgdXBkYXRlRHVyYXRpb24oKTtcclxufVxyXG5cclxuZnVuY3Rpb24gdXBkYXRlRHVyYXRpb24oKSB7XHJcbiAgZHVyYXRpb25Db250cm9sLnZhbHVlID0gdmlkZW8uY3VycmVudFRpbWU7XHJcbiAgbGV0IHN0ZXAgPSB2aWRlby5kdXJhdGlvbiAvIDEwMDtcclxuICBsZXQgcGVyY2VudCA9IHZpZGVvLmN1cnJlbnRUaW1lIC8gc3RlcDtcclxuICBkdXJhdGlvbkNvbnRyb2wuc3R5bGUuYmFja2dyb3VuZCA9IGBsaW5lYXItZ3JhZGllbnQoOTBkZWcsICNGRURCM0YgMCUsICNGRURCM0YgJHtwZXJjZW50fSUsICM2MjYyNjIgJHtwZXJjZW50fSUpYDtcclxufVxyXG5cclxuZnVuY3Rpb24gY2hhbmdlU291bmRWb2x1bWUoKSB7XHJcbiAgdmlkZW8udm9sdW1lID0gc291bmRDb250cm9sLnZhbHVlIC8gMTA7XHJcbiAgaWYgKHZpZGVvLnZvbHVtZSA9PT0gMCkge1xyXG4gICAgc291bmRCdG4uY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc291bmRPZigpIHtcclxuICBpZiAodmlkZW8udm9sdW1lID09PSAwKSB7XHJcbiAgICB2aWRlby52b2x1bWUgPSBzb3VuZExldmVsO1xyXG4gICAgc291bmRDb250cm9sLnZhbHVlID0gc291bmRMZXZlbCAqIDEwO1xyXG4gICAgc291bmRCdG4uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIHNvdW5kTGV2ZWwgPSB2aWRlby52b2x1bWU7XHJcbiAgICB2aWRlby52b2x1bWUgPSAwO1xyXG4gICAgc291bmRDb250cm9sLnZhbHVlID0gMDtcclxuICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gIH1cclxufSIsImNvbnN0IHNsaWRlciA9ICQoJy5wcm9kdWN0cycpLmJ4U2xpZGVyKHtcclxuICBwYWdlcjogZmFsc2UsXHJcbiAgY29udHJvbHM6IGZhbHNlXHJcbn0pO1xyXG5cclxuJCgnLnByb2R1Y3Qtc2xpZGVyX19hcnJvdy0tZGlyZWN0aW9uLS1wcmV2JykuY2xpY2soZSA9PiB7XHJcbiAgc2xpZGVyLmdvVG9QcmV2U2xpZGUoKTtcclxufSk7XHJcblxyXG4kKCcucHJvZHVjdC1zbGlkZXJfX2Fycm93LS1kaXJlY3Rpb24tLW5leHQnKS5jbGljayhlID0+IHtcclxuICBzbGlkZXIuZ29Ub05leHRTbGlkZSgpO1xyXG59KTsiLCJjb25zdCBmaW5kQmxvY2tCeUFsaWFzID0gYWxpYXMgPT4ge1xyXG4gIHJldHVybiAkKCcucmV2aWV3c19faXRlbScpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XHJcbiAgICByZXR1cm4gJChpdGVtKS5hdHRyKCdkYXRhLWxpbmtlZC13aXRoJykgPT0gYWxpYXNcclxuICB9KTtcclxufTtcclxuXHJcbiQoJy5pbnRlcmFjdGl2ZS1hdmF0YXJfX2xpbmsnKS5jbGljayhlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gIGNvbnN0IHRhcmdldCA9ICR0aGlzLmF0dHIoJ2RhdGEtb3BlbicpO1xyXG4gIGNvbnN0IGl0ZW1Ub1Nob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldCk7XHJcbiAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoJy5yZXZpZXdzX19zd2l0Y2hlci1pdGVtJyk7XHJcblxyXG4gIGl0ZW1Ub1Nob3cuYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gIGN1ckl0ZW0uYWRkQ2xhc3MoJ2FjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG59KTsiXX0=
